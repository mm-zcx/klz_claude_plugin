---
name: qt-cpp-review
description: Qt C++代码审查技能,用于审查和分析Qt C++代码的质量、规范性和性能。在以下场景中使用:(1) 审查单个或多个Qt C++源文件(.h/.cpp)的代码质量 (2) 检查Qt项目整体代码规范遵循情况 (3) 编码规范检查,确保遵循Qt官方规范和项目自定义规范 (4) 架构审查,分析代码设计和结构合理性。支持Qt 5和Qt 6,关注Qt特定规范、C++最佳实践、性能优化和代码风格一致性。
---

# Qt C++ 代码审查技能

## 概述

本技能提供全面的Qt C++代码审查能力,帮助识别代码质量问题、规范违规、潜在bug和性能优化机会。审查基于Qt官方编码规范、项目自定义规范以及C++最佳实践。

## 审查维度

### 1. Qt特定规范
- 信号槽连接方式(优先使用函数指针)
- 对象树和内存管理
- Qt容器使用(QVector, QList, QMap等)
- 跨线程通信和线程安全
- Qt资源管理和国际化

### 2. C++最佳实践
- 内存管理(new/delete配对,智能指针)
- RAII原则应用
- 异常安全
- const正确性
- 资源管理

### 3. 性能优化
- 避免不必要的拷贝(使用const引用)
- 隐式共享(COW)利用
- 字符串处理优化
- 绘制和UI性能
- 延迟初始化

### 4. 代码风格一致性
- 命名规范(类、函数、变量、常量)
- 代码格式和缩进
- 注释质量和完整性
- 头文件组织和依赖

## 审查类型

### 🔴 严重问题(Must Fix)
- 内存泄漏
- 线程安全问题
- GUI在非主线程操作
- 资源未释放
- 未定义行为

### 🟡 重要问题(Should Fix)
- 性能问题
- 信号槽连接错误
- 内存管理不当
- 明显的架构缺陷

### 🟢 建议改进(Nice to Have)
- 命名规范不一致
- 代码风格问题
- 注释缺失
- 可选的性能优化

## 审查流程

1. **理解代码**: 分析代码结构和目的
2. **识别问题**: 按优先级检查各维度
3. **提供反馈**: 标注位置、问题类型、改进建议
4. **生成报告**: 总结问题清单和修改建议

## 参考资源

### 编码规范

**[qt-coding-standards.md](references/qt-coding-standards.md)**
Qt官方编码规范,包含:
- 命名规范
- 信号槽最佳实践
- 内存管理模式
- 线程安全指南
- 性能优化建议
- Qt版本兼容性(Qt 5 & 6)

**[project-standards.md](references/project-standards.md)**
项目自定义编码规范,包含:
- 类命名(C前缀规范)
- 成员变量(m_前缀规范)
- 函数参数命名(小写下划线)
- 大括号使用(独占一行)
- 注释规范和模板
- 代码排版规则

### 检查清单

**[checklist.md](references/checklist.md)**
详细代码审查检查清单,包含:
- 命名规范检查(类、函数、变量、枚举)
- 内存管理检查(对象树、智能指针、泄漏风险)
- 信号槽检查(连接方式、参数、命名)
- 线程安全检查(QThread、GUI操作、数据共享)
- 性能优化检查(拷贝、绘制、字符串处理)
- 代码风格检查(头文件、格式、注释)
- 架构设计检查(职责分离、继承组合)
- Qt特定规范检查(容器、资源、国际化)

## 使用方式

### 审查单个文件
```
请审查以下Qt C++文件的代码质量
[粘贴代码或提供文件路径]
```

### 审查项目整体
```
请审查以下Qt项目的代码规范遵循情况
[提供项目路径或描述项目结构]
```

### 特定维度审查
```
请检查以下代码的内存管理问题
[粘贴代码]

请分析以下Qt代码的性能优化空间
[粘贴代码]

请审查信号槽连接是否正确
[粘贴代码]
```

### 编码规范检查
```
请检查以下代码是否符合项目编码规范
[粘贴代码]
重点关注: 命名规范、大括号使用、注释完整性
```

## 审查输出格式

审查结果应包含:

1. **总体评估**: 代码质量概况和主要问题
2. **问题清单**: 按优先级分类的问题列表
   - 位置(文件名:行号)
   - 问题描述
   - 问题级别(严重/重要/建议)
   - 修改建议
3. **改进建议**: 具体的代码修改示例
4. **最佳实践**: 相关的编码规范引用

## 常见审查项

### 命名规范示例
```cpp
// ❌ 错误: 类名缺少C前缀
class MySystem {
    int value;  // ❌ 成员变量缺少m_前缀
};

// ✅ 正确
class CMySystem {
    int m_value;
};
```

### 信号槽连接示例
```cpp
// ❌ 错误: 使用旧式宏(无类型安全)
connect(sender, SIGNAL(valueChanged(QString)),
        receiver, SLOT(updateValue(QString)));

// ✅ 正确: 使用函数指针(Qt 5.7+)
connect(sender, &Sender::valueChanged,
        receiver, &Receiver::updateValue);
```

### 内存管理示例
```cpp
// ❌ 错误: 未指定父对象
QPushButton *button = new QPushButton();

// ✅ 正确: 指定父对象
QPushButton *button = new QPushButton(parent);
```

### 性能优化示例
```cpp
// ❌ 错误: 值传递大对象
void processList(QList<QString> items) {}

// ✅ 正确: const引用传递
void processList(const QList<QString>& items) {}
```

### 代码格式示例
```cpp
// ❌ 错误: 大括号不独占一行
if (condition) {
    return;
}

// ✅ 正确: 大括号独占一行
if (condition)
{
    return;
}
```

## 加载参考文件的时机

- **初始审查**: 先加载[checklist.md](references/checklist.md)获取完整检查项
- **规范查询**: 根据问题类型加载对应规范文件
  - Qt特定问题 → [qt-coding-standards.md](references/qt-coding-standards.md)
  - 项目规范问题 → [project-standards.md](references/project-standards.md)
- **深入分析**: 根据具体问题定位到相关章节

## 审查原则

1. **正确性优先**: 功能正确性 > 稳定性 > 可测试性 > 可读性
2. **建设性反馈**: 不仅指出问题,更提供解决方案
3. **规范一致性**: 确保代码符合Qt官方和项目规范
4. **实用主义**: 优先关注影响严重的问题
5. **学习导向**: 帮助开发者理解最佳实践

## 快速参考

### 项目规范要点
- 类名: C前缀 + 大驼峰
- 成员变量: m_前缀 + 小驼峰
- 全局变量: g_前缀 + 小驼峰
- 常量: 全大写下划线
- 函数参数: 小写下划线
- 大括号: 独占一行
- 缩进: 4空格

### Qt最佳实践
- 使用函数指针连接信号槽
- 利用对象树管理内存
- const引用传递大对象
- GUI操作仅限主线程
- 使用tr()支持国际化
- 优先使用Qt容器而非STL
